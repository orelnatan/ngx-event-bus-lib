version: 2.1

jobs:
  build:
    docker:
      - image: cimg/node:22.18
    steps:
      - checkout

      - run:
          name: Install dependencies
          command: npm install

      - run:
          name: Build Angular library
          command: npm run build

      - run:
          name: Run unit tests with coverage
          command: npx ng test ngx-event-bus-lib --watch=false --coverage

      # üîç TEMP DEBUG STEP ‚Äî ADD THIS
      - run:
          name: Debug coverage output
          command: |
            echo "=== coverage tree ==="
            find coverage -type f

      - run:
          name: Upload coverage to Codecov
          command: |
            curl -s https://codecov.io/bash | bash -s -- \
              -f coverage/ngx-event-bus-lib/lcov.info
